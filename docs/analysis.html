<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principal Component Analysis - 5&nbsp; Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./methods.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./analysis.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Principal Component Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dataset</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries"><span class="header-section-number">5.1</span> Libraries</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">5.2</span> 01 - Data Preparation</a></li>
  <li><a href="#feature-scaling" id="toc-feature-scaling" class="nav-link" data-scroll-target="#feature-scaling"><span class="header-section-number">5.3</span> 02 - Feature Scaling</a></li>
  <li><a href="#pca-requirements" id="toc-pca-requirements" class="nav-link" data-scroll-target="#pca-requirements"><span class="header-section-number">5.4</span> 03 - PCA Requirements</a>
  <ul class="collapse">
  <li><a href="#outliers-detection" id="toc-outliers-detection" class="nav-link" data-scroll-target="#outliers-detection"><span class="header-section-number">5.4.1</span> Outliers Detection</a></li>
  <li><a href="#leverage" id="toc-leverage" class="nav-link" data-scroll-target="#leverage"><span class="header-section-number">5.4.2</span> Leverage</a></li>
  <li><a href="#removing-outliers" id="toc-removing-outliers" class="nav-link" data-scroll-target="#removing-outliers"><span class="header-section-number">5.4.3</span> Removing Outliers</a></li>
  <li><a href="#correlations" id="toc-correlations" class="nav-link" data-scroll-target="#correlations"><span class="header-section-number">5.4.4</span> Correlations</a></li>
  </ul></li>
  <li><a href="#full-model-regression" id="toc-full-model-regression" class="nav-link" data-scroll-target="#full-model-regression"><span class="header-section-number">5.5</span> Full Model Regression</a></li>
  <li><a href="#pca-analysis" id="toc-pca-analysis" class="nav-link" data-scroll-target="#pca-analysis"><span class="header-section-number">5.6</span> 04 - PCA Analysis</a>
  <ul class="collapse">
  <li><a href="#svd---singular-value-decomposition" id="toc-svd---singular-value-decomposition" class="nav-link" data-scroll-target="#svd---singular-value-decomposition"><span class="header-section-number">5.6.1</span> SVD - Singular Value Decomposition</a></li>
  <li><a href="#pca---elements" id="toc-pca---elements" class="nav-link" data-scroll-target="#pca---elements"><span class="header-section-number">5.6.2</span> PCA - Elements</a></li>
  <li><a href="#loadings-of-first-two-components" id="toc-loadings-of-first-two-components" class="nav-link" data-scroll-target="#loadings-of-first-two-components"><span class="header-section-number">5.6.3</span> Loadings of First Two Components</a></li>
  <li><a href="#pca---cumulative-variance" id="toc-pca---cumulative-variance" class="nav-link" data-scroll-target="#pca---cumulative-variance"><span class="header-section-number">5.6.4</span> PCA - Cumulative Variance</a></li>
  <li><a href="#pca---number-of-principal-components" id="toc-pca---number-of-principal-components" class="nav-link" data-scroll-target="#pca---number-of-principal-components"><span class="header-section-number">5.6.5</span> PCA - Number of Principal Components</a></li>
  </ul></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">5.7</span> 05 - Visualization</a>
  <ul class="collapse">
  <li><a href="#scree-plot---cumulative-variance-explained" id="toc-scree-plot---cumulative-variance-explained" class="nav-link" data-scroll-target="#scree-plot---cumulative-variance-explained"><span class="header-section-number">5.7.1</span> Scree Plot - Cumulative Variance Explained</a></li>
  <li><a href="#biplot" id="toc-biplot" class="nav-link" data-scroll-target="#biplot"><span class="header-section-number">5.7.2</span> Biplot</a></li>
  <li><a href="#correlation-circle" id="toc-correlation-circle" class="nav-link" data-scroll-target="#correlation-circle"><span class="header-section-number">5.7.3</span> Correlation Circle</a></li>
  <li><a href="#variable-contribution" id="toc-variable-contribution" class="nav-link" data-scroll-target="#variable-contribution"><span class="header-section-number">5.7.4</span> Variable Contribution</a></li>
  </ul></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building"><span class="header-section-number">5.8</span> 06 - Model Building</a>
  <ul class="collapse">
  <li><a href="#data-splitting-into-training-test-set" id="toc-data-splitting-into-training-test-set" class="nav-link" data-scroll-target="#data-splitting-into-training-test-set"><span class="header-section-number">5.8.1</span> Data Splitting into Training &amp; Test set</a></li>
  <li><a href="#feature-scaling-standardization" id="toc-feature-scaling-standardization" class="nav-link" data-scroll-target="#feature-scaling-standardization"><span class="header-section-number">5.8.2</span> Feature Scaling: Standardization</a></li>
  <li><a href="#applying-pca-to-training-test-sets" id="toc-applying-pca-to-training-test-sets" class="nav-link" data-scroll-target="#applying-pca-to-training-test-sets"><span class="header-section-number">5.8.3</span> Applying PCA to Training &amp; Test sets</a></li>
  <li><a href="#press-predicted-r2-functions" id="toc-press-predicted-r2-functions" class="nav-link" data-scroll-target="#press-predicted-r2-functions"><span class="header-section-number">5.8.4</span> PRESS &amp; Predicted R^2 Functions</a></li>
  <li><a href="#pca-full-model---8-principal-components" id="toc-pca-full-model---8-principal-components" class="nav-link" data-scroll-target="#pca-full-model---8-principal-components"><span class="header-section-number">5.8.5</span> PCA Full Model - 8 Principal Components</a></li>
  <li><a href="#visualization-of-uncorrelated-pca-matrix" id="toc-visualization-of-uncorrelated-pca-matrix" class="nav-link" data-scroll-target="#visualization-of-uncorrelated-pca-matrix"><span class="header-section-number">5.8.6</span> Visualization of Uncorrelated PCA Matrix</a></li>
  </ul></li>
  <li><a href="#pca---2-principal-components" id="toc-pca---2-principal-components" class="nav-link" data-scroll-target="#pca---2-principal-components"><span class="header-section-number">5.9</span> PCA - 2 Principal Components</a>
  <ul class="collapse">
  <li><a href="#principal-components-regression" id="toc-principal-components-regression" class="nav-link" data-scroll-target="#principal-components-regression"><span class="header-section-number">5.9.1</span> <strong>Principal Components Regression</strong></a></li>
  <li><a href="#repeated-cross-validation" id="toc-repeated-cross-validation" class="nav-link" data-scroll-target="#repeated-cross-validation"><span class="header-section-number">5.9.2</span> Repeated Cross-Validation</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">5.9.3</span> Cross-Validation</a></li>
  </ul></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions"><span class="header-section-number">5.10</span> 07 - Predictions</a>
  <ul class="collapse">
  <li><a href="#prediction-metrics" id="toc-prediction-metrics" class="nav-link" data-scroll-target="#prediction-metrics"><span class="header-section-number">5.10.1</span> Prediction Metrics</a></li>
  </ul></li>
  <li><a href="#training-conclusion" id="toc-training-conclusion" class="nav-link" data-scroll-target="#training-conclusion"><span class="header-section-number">5.11</span> 08 - Training Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="libraries" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">5.1</span> Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)    <span class="co"># for handling missing values</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats) <span class="co"># for rosnerTest</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)        <span class="co"># for outliers test</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)      <span class="co"># correlation matrix</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot) <span class="co"># correlation graph</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR) <span class="co"># PCA analysis</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra) <span class="co"># PCA plots</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)        <span class="co"># PC regression</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)      <span class="co"># to fit transform PCA </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)        <span class="co"># outliers, leverage plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-preparation" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">5.2</span> 01 - Data Preparation</h2>
<p>In the previous Dataset section, we renamed the variables to be more significant, and easier to make inference. Moreover, we imputed the missing values with the Mean.</p>
</section>
<section id="feature-scaling" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="feature-scaling"><span class="header-section-number">5.3</span> 02 - Feature Scaling</h2>
<ul>
<li>Standardization ensures all features are on the same scale, and this method is less sensitive to outliers.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the index position of the target feature </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>target_name <span class="ot">&lt;-</span> <span class="st">"expected_survival"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>target_index <span class="ot">&lt;-</span> <span class="fu">grep</span>(target_name, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">colnames</span>(train_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardization Numerical Features</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>train_data_sc <span class="ot">&lt;-</span> <span class="fu">scale</span>(train_data[, <span class="sc">-</span>target_index])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pca-requirements" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="pca-requirements"><span class="header-section-number">5.4</span> 03 - PCA Requirements</h2>
<section id="outliers-detection" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="outliers-detection"><span class="header-section-number">5.4.1</span> Outliers Detection</h3>
<ul>
<li>There are some outliers in the data frame.</li>
<li>However, there are three outliers with no high leverage.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a boxplot to visualize potential outliers</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(train_data_sc, <span class="at">main =</span> <span class="st">"Outliers Detection"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="leverage" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="leverage"><span class="header-section-number">5.4.2</span> Leverage</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ordinary_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(expected_survival <span class="sc">~</span> ., <span class="at">data =</span> train_data)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ordinary_model)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual Diagnostics</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_plot_resid_lev</span>(ordinary_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="removing-outliers" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="removing-outliers"><span class="header-section-number">5.4.3</span> Removing Outliers</h3>
<p>After removing one outlier from the dataset, we discovered that the final results produced minimal variability. Therefore, we decided to present a model that captures all the data pointsâ€™ information; thus, no observations will be removed from the final model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No Outliers subset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>no_outliers_df <span class="ot">&lt;-</span> <span class="fu">slice</span>(train_data, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">56</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>no_outliers_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(expected_survival <span class="sc">~</span> ., <span class="at">data =</span> no_outliers_df)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(no_outliers_model)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual Diagnostics</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_plot_resid_lev</span>(no_outliers_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="correlations" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="correlations"><span class="header-section-number">5.4.4</span> Correlations</h3>
<ul>
<li><p>There are high correlated features.</p></li>
<li><p>Multicollinearity is present in the data set.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlations and round to 2 digits</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(train_data_sc)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="ot">&lt;-</span> <span class="fu">round</span>(corr_matrix, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print names of highly correlated features; threshold &gt; 0.30</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>high <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(corr_matrix, <span class="at">cutoff =</span> <span class="fl">0.30</span>, <span class="at">names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>high</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "expected_transfusion"                  
 [2] "better_infection"                      
 [3] "expected_hospitalization"              
 [4] "expected_hospital_readmission"         
 [5] "expected_fistula"                      
 [6] "prevalent_transplant_waitlist_expected"
 [7] "incident_transplant_waitlist_expected" 
 [8] "expected_infection"                    
 [9] "worse_survival"                        
[10] "incident_transplant_waitlist_better"   
[11] "better_hospital_readmission"           
[12] "worse_transfusion"                     
[13] "worse_hospital_readmission"            
[14] "worse_fistula"                         
[15] "incident_transplant_waitlist_worse"    
[16] "better_fistula"                        
[17] "prevalent_transplant_waitlist_better"  
[18] "better_survival"                       
[19] "worse_infection"                       
[20] "phosphorus (5.6 - 7) Mg"               
[21] "prevalent_transplant_waitlist_worse"   
[22] "phosphorus (3.5 - 4.5) Mg"             
[23] "phosphorus &gt; 7Mg"                      
[24] "better_transfusion"                    
[25] "Hgb 10g"                               
[26] "hypercalcemia_calcium &gt; 10.2Mg"        
[27] "pediatric_nPCR"                        
[28] "long_term_catheter"                    </code></pre>
</div>
</div>
</section>
</section>
<section id="full-model-regression" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="full-model-regression"><span class="header-section-number">5.5</span> Full Model Regression</h2>
<ul>
<li>The Adjusted R^2 = 99.99% is an indication of over-fitting, or bias.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a multiple linear regression model</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(expected_survival <span class="sc">~</span> ., <span class="at">data =</span> train_data)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of the regression model</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expected_survival ~ ., data = train_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.44543 -0.31575 -0.05481  0.39273  1.13134 

Coefficients:
                                         Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                            93.7141729 41.8771301   2.238 0.038114
better_transfusion                      1.0433623  0.7504271   1.390 0.181374
expected_transfusion                    0.0011165  0.0339108   0.033 0.974098
worse_transfusion                       0.1321425  0.0752163   1.757 0.095943
better_infection                       -0.2665210  0.0913321  -2.918 0.009178
expected_infection                     -0.0353924  0.0617830  -0.573 0.573833
worse_infection                        -0.1114838  0.2720510  -0.410 0.686796
Kt_v_1.2                                0.2515467  0.2538274   0.991 0.334814
Kt_v_1.7                               -0.0002502  0.0523052  -0.005 0.996236
pedriatic_Kt_v_1.2                     -0.0399970  0.0330110  -1.212 0.241322
pediatric_Kt_v_1.8                     -0.0179608  0.0095227  -1.886 0.075523
pediatric_nPCR                          0.0444777  0.0254264   1.749 0.097275
better_fistula                         -0.1839466  0.1065136  -1.727 0.101292
expected_fistula                        0.0061566  0.0750108   0.082 0.935492
worse_fistula                          -0.0301080  0.1060795  -0.284 0.779783
long_term_catheter                      0.3116122  0.0743814   4.189 0.000551
`hypercalcemia_calcium &gt; 10.2Mg`       -0.1874432  0.0881679  -2.126 0.047599
`phosphorus &lt; 3.5Mg`                    0.3493258  0.4794052   0.729 0.475581
`phosphorus (3.5 - 4.5) Mg`            -1.7332425  0.4642343  -3.734 0.001521
`phosphorus (4.6 - 5.5) Mg`            -1.3625429  0.4593524  -2.966 0.008270
`phosphorus (5.6 - 7) Mg`              -0.7983529  0.4384021  -1.821 0.085264
`phosphorus &gt; 7Mg`                     -1.4438916  0.4577542  -3.154 0.005486
better_hospitalization                  0.0845105  0.3231725   0.262 0.796674
expected_hospitalization                0.7045325  0.1549119   4.548 0.000249
worse_hospitalization                   0.5177565  0.2210441   2.342 0.030859
better_hospital_readmission             0.3755861  0.2422979   1.550 0.138521
expected_hospital_readmission           0.3149471  0.1346618   2.339 0.031081
worse_hospital_readmission              0.0922372  0.2390186   0.386 0.704094
better_survival                        -0.5713254  0.1451346  -3.937 0.000967
worse_survival                         -0.9107860  0.1372411  -6.636 3.14e-06
incident_transplant_waitlist_better     0.0124309  0.1326932   0.094 0.926397
incident_transplant_waitlist_expected   0.0335712  0.0407496   0.824 0.420813
incident_transplant_waitlist_worse      0.3111204  0.1192201   2.610 0.017736
prevalent_transplant_waitlist_better    0.1505592  0.1108400   1.358 0.191136
prevalent_transplant_waitlist_expected  0.0410843  0.1012918   0.406 0.689815
prevalent_transplant_waitlist_worse     0.0060570  0.1878661   0.032 0.974635
`Hgb 10g`                              -0.1026231  0.0478780  -2.143 0.045990
`Hgb 12g`                              -0.3572380  0.6630944  -0.539 0.596664
                                          
(Intercept)                            *  
better_transfusion                        
expected_transfusion                      
worse_transfusion                      .  
better_infection                       ** 
expected_infection                        
worse_infection                           
Kt_v_1.2                                  
Kt_v_1.7                                  
pedriatic_Kt_v_1.2                        
pediatric_Kt_v_1.8                     .  
pediatric_nPCR                         .  
better_fistula                            
expected_fistula                          
worse_fistula                             
long_term_catheter                     ***
`hypercalcemia_calcium &gt; 10.2Mg`       *  
`phosphorus &lt; 3.5Mg`                      
`phosphorus (3.5 - 4.5) Mg`            ** 
`phosphorus (4.6 - 5.5) Mg`            ** 
`phosphorus (5.6 - 7) Mg`              .  
`phosphorus &gt; 7Mg`                     ** 
better_hospitalization                    
expected_hospitalization               ***
worse_hospitalization                  *  
better_hospital_readmission               
expected_hospital_readmission          *  
worse_hospital_readmission                
better_survival                        ***
worse_survival                         ***
incident_transplant_waitlist_better       
incident_transplant_waitlist_expected     
incident_transplant_waitlist_worse     *  
prevalent_transplant_waitlist_better      
prevalent_transplant_waitlist_expected    
prevalent_transplant_waitlist_worse       
`Hgb 10g`                              *  
`Hgb 12g`                                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.052 on 18 degrees of freedom
Multiple R-squared:      1, Adjusted R-squared:  0.9999 
F-statistic: 2.69e+04 on 37 and 18 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="pca-analysis" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="pca-analysis"><span class="header-section-number">5.6</span> 04 - PCA Analysis</h2>
<section id="svd---singular-value-decomposition" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="svd---singular-value-decomposition"><span class="header-section-number">5.6.1</span> SVD - Singular Value Decomposition</h3>
<p>We will focus on Singular Value Decomposition which is a classic approach for PCA analysis.</p>
<p>Singular Value Decomposition is a factorization technique used in linear algebra to decompose a matrix into three matrices.</p>
<ol type="1">
<li><p>U: A matrix whose columns are the left singular vectors of the original matrix.</p></li>
<li><p>D: A diagonal matrix whose entries are the singular values of the original matrix.</p></li>
<li><p>V: A matrix whose columns are the right singular vectors of the original matrix.</p></li>
</ol>
<p>The SVD is closely related to the eigenvalue decomposition (EVD), which is another factorization technique used in linear algebra. While the EVD can only be applied to square matrices, the SVD can be applied to any matrix, including rectangular matrices. The SVD is also more numerically stable than the EVD, making it a preferred method for many applications.</p>
<ul>
<li>Note: The Spectral Decomposition approach is used with the princomp() function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA using prcomp()</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>data_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(train_data_sc, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                         PC1     PC2     PC3     PC4    PC5     PC6     PC7
Standard deviation     3.885 1.87172 1.83774 1.74868 1.4227 1.25078 1.12796
Proportion of Variance 0.408 0.09468 0.09128 0.08265 0.0547 0.04228 0.03439
Cumulative Proportion  0.408 0.50269 0.59397 0.67661 0.7313 0.77360 0.80799
                           PC8     PC9    PC10    PC11   PC12    PC13    PC14
Standard deviation     1.09332 0.94491 0.90813 0.81855 0.7790 0.68145 0.63663
Proportion of Variance 0.03231 0.02413 0.02229 0.01811 0.0164 0.01255 0.01095
Cumulative Proportion  0.84029 0.86442 0.88671 0.90482 0.9212 0.93378 0.94473
                          PC15    PC16   PC17    PC18    PC19   PC20    PC21
Standard deviation     0.57103 0.50547 0.5018 0.48845 0.46247 0.4169 0.35338
Proportion of Variance 0.00881 0.00691 0.0068 0.00645 0.00578 0.0047 0.00338
Cumulative Proportion  0.95354 0.96045 0.9673 0.97370 0.97948 0.9842 0.98755
                          PC22    PC23    PC24    PC25    PC26    PC27    PC28
Standard deviation     0.32474 0.28837 0.26042 0.22590 0.21491 0.19820 0.16698
Proportion of Variance 0.00285 0.00225 0.00183 0.00138 0.00125 0.00106 0.00075
Cumulative Proportion  0.99040 0.99265 0.99448 0.99586 0.99711 0.99817 0.99893
                          PC29    PC30    PC31    PC32    PC33    PC34    PC35
Standard deviation     0.12679 0.10914 0.08380 0.05094 0.03167 0.02871 0.01433
Proportion of Variance 0.00043 0.00032 0.00019 0.00007 0.00003 0.00002 0.00001
Cumulative Proportion  0.99936 0.99968 0.99987 0.99994 0.99997 0.99999 1.00000
                           PC36     PC37
Standard deviation     0.008057 0.004918
Proportion of Variance 0.000000 0.000000
Cumulative Proportion  1.000000 1.000000</code></pre>
</div>
</div>
</section>
<section id="pca---elements" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="pca---elements"><span class="header-section-number">5.6.2</span> PCA - Elements</h3>
<ul>
<li><p>The values in <strong><code>data_pca$x</code></strong> are the coordinates of each observation in the new principal component space. These coordinates are the scores for each observation along each principal component.</p></li>
<li><p>The eigenvectors of the covariance or correlation matrix of the data represent the directions of maximum variance or information in the dataset.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Principal Component scores vector</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pc_scores <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>x</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Std Deviation of Components</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>component_sdev <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>sdev</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Eigenvector, or Loadings</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>eigenvector <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>rotation</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean of variables</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>component_mean <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>center </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling factor of Variables</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>component_scale <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>scale</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loadings-of-first-two-components" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="loadings-of-first-two-components"><span class="header-section-number">5.6.3</span> Loadings of First Two Components</h3>
<ul>
<li>The loading are the weights assigned to each variable for that particular principal component.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the loadings for the first two principal components</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>loadings_first_two_components <span class="ot">&lt;-</span> eigenvector[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the loadings for the first two principal components</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Loadings for the first two principal components:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Loadings for the first two principal components:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loadings_first_two_components)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 PC1          PC2
better_transfusion                      0.0505988170  0.015071362
expected_transfusion                    0.2535655387 -0.021428805
worse_transfusion                       0.2058083243 -0.164735938
better_infection                        0.2526036797 -0.007341849
expected_infection                      0.2455149674 -0.065172327
worse_infection                         0.1381076997  0.063702113
Kt_v_1.2                                0.0030888370  0.008117565
Kt_v_1.7                               -0.0077627944  0.044354338
pedriatic_Kt_v_1.2                     -0.0635839673  0.052731221
pediatric_Kt_v_1.8                     -0.0139161654  0.002781654
pediatric_nPCR                         -0.0394255772  0.076824152
better_fistula                          0.1701351094  0.184888641
expected_fistula                        0.2521168144 -0.055750964
worse_fistula                           0.1932023133 -0.048145074
long_term_catheter                     -0.0054339687  0.040853832
hypercalcemia_calcium &gt; 10.2Mg         -0.0276031313  0.104909219
phosphorus &lt; 3.5Mg                      0.0161465158  0.375887922
phosphorus (3.5 - 4.5) Mg               0.0419719997  0.425799543
phosphorus (4.6 - 5.5) Mg               0.0888141257  0.266545080
phosphorus (5.6 - 7) Mg                -0.0954250049 -0.329731283
phosphorus &gt; 7Mg                       -0.0293097443 -0.439982654
better_hospitalization                  0.1554828676  0.039769206
expected_hospitalization                0.2534938280 -0.035294582
worse_hospitalization                   0.1862740734 -0.104759047
better_hospital_readmission             0.2100006566 -0.046207863
expected_hospital_readmission           0.2537238605 -0.041416989
worse_hospital_readmission              0.2009955081 -0.043217623
better_survival                         0.1522860091  0.168831835
worse_survival                          0.2288119832 -0.066222930
incident_transplant_waitlist_better     0.2015728228  0.151287289
incident_transplant_waitlist_expected   0.2498798110 -0.057824581
incident_transplant_waitlist_worse      0.1912997762 -0.019853974
prevalent_transplant_waitlist_better    0.1617720280  0.176291623
prevalent_transplant_waitlist_expected  0.2500769232 -0.070274998
prevalent_transplant_waitlist_worse     0.1201730964 -0.228472026
Hgb 10g                                -0.0298792287 -0.080370928
Hgb 12g                                -0.0005836729  0.176481318</code></pre>
</div>
</div>
</section>
<section id="pca---cumulative-variance" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="pca---cumulative-variance"><span class="header-section-number">5.6.4</span> PCA - Cumulative Variance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of variance explained by each PC</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="ot">&lt;-</span> component_sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(component_sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative proportion of variance explained</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>cumulative_variance_explained <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(variance_explained)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>cumulative_variance_explained</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.4080054 0.5026901 0.5939685 0.6766143 0.7313169 0.7735996 0.8079857
 [8] 0.8402922 0.8644234 0.8867126 0.9048213 0.9212244 0.9337751 0.9447292
[15] 0.9535419 0.9604473 0.9672517 0.9736998 0.9794804 0.9841779 0.9875530
[22] 0.9904031 0.9926506 0.9944835 0.9958627 0.9971109 0.9981727 0.9989263
[29] 0.9993607 0.9996827 0.9998725 0.9999427 0.9999698 0.9999920 0.9999976
[36] 0.9999993 1.0000000</code></pre>
</div>
</div>
</section>
<section id="pca---number-of-principal-components" class="level3" data-number="5.6.5">
<h3 data-number="5.6.5" class="anchored" data-anchor-id="pca---number-of-principal-components"><span class="header-section-number">5.6.5</span> PCA - Number of Principal Components</h3>
<ul>
<li>We conclude that 9 Principal Components explain 86% of the variance.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retain components that explain a percentage of the variance</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>num_components <span class="ot">&lt;-</span> <span class="fu">which</span>(cumulative_variance_explained <span class="sc">&gt;=</span> <span class="fl">0.86</span>)[<span class="dv">1</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the desired number of principal components</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>selected_pcs <span class="ot">&lt;-</span> pc_scores[, <span class="dv">1</span><span class="sc">:</span>num_components]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>selected_pcs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          PC1          PC2         PC3          PC4         PC5         PC6
1  -3.1377897  0.771802333 -0.73643610 -0.922235383 -0.35927448  0.38542561
2   0.9108769 -1.373614712 -0.89066560 -0.046036426  0.02278572  0.32672341
3  -1.3650210 -1.765641978 -0.14492292  0.259189212 -1.28569119 -0.37616348
4  -3.0594171  0.334783454 -0.01406268 -0.139540012  0.09202588 -0.28246147
5  -0.1990728 -0.207347300 -0.71486169 -1.375622870 -1.19927381  0.03193723
6  15.2031917  2.618707806 -7.73627571  4.051949166 -0.82443732 -2.82184549
7  -1.1596436  1.121551314 -0.71119818 -0.684236835  0.22859575 -0.38210147
8  -1.7566946  2.446404457  0.23358063 -0.787124212 -0.10982171 -1.06033591
9  -2.5604524  1.078492112 -0.02070808 -0.001800478 -0.24737807  1.19300909
10 -2.2725299  0.767002717 -0.05524655 -1.004506232  2.44302298 -1.80923423
11 10.2100889 -3.095058992  5.56314501 -2.707865857 -3.23281430 -1.47878094
12  5.1285806 -1.770508028  1.78490237 -0.162837263  0.51758150 -0.36715154
13 -3.4958456 -4.420614532 -3.14253662  0.040387883 -0.79275740  0.42165629
14 -1.7133698  0.822955825 -1.96628840 -1.087070858  0.75045171  0.43567043
15 -1.9510677  0.907515363 -0.34586585 -1.470709937 -0.77348447 -0.78101531
16 -2.6295662  0.914891571 -0.52633428 -1.348424988 -0.93480439  0.51812412
17  4.7463371  0.314584946  2.37090668 -0.252790732  0.83290377  1.42903927
18  0.3868186 -0.929048000  0.68704793 -0.611740653  1.53736445 -0.11125974
19 -1.6766975  0.284981397 -0.98417172 -1.813309386 -0.81355933  0.75181767
20 -0.7344809 -1.322183158  0.37001336 -0.844751806  2.05528745 -1.60184302
21  0.9392629 -0.699900216 -0.13989705 -0.597819034 -0.02027423 -0.00460663
22 -0.8326091  1.587389983 -0.73121315  0.290973848  0.11987111  1.10998873
23  0.8724526  1.045058855  0.27746739  0.217533123 -0.62257760  0.54288629
24 -2.7729541  0.532823236 -0.38569030 -0.934135557  0.89428334 -2.72370097
25  2.0146426  0.001409232  0.64033906 -0.692861288 -0.16774408  0.45551037
26 -1.1376241  0.667578303  0.06120837  0.244365584 -0.44647286  0.92651259
27  0.1255818 -0.995109875  1.15033009 -0.489711370  0.71084468  1.38539681
28 -3.6485929 -5.124718566  0.04913529  6.332224295 -1.44380969  1.47256020
29 -0.3307121  0.279250049 -0.09852864 -0.338816118 -0.59497247 -0.57611719
30 -3.1386137 -2.484679699 -2.00441012  1.066087068 -0.58765600 -0.02923877
31  1.8304255 -0.865860455 -0.62921128 -0.288806050 -0.35848754  1.15223519
32 -2.6299851  1.882042739  1.47902941  1.519749388  0.14837356  0.99433001
33 -1.9654200  1.443737323  0.42388464 -1.421726497  0.34517137  0.14894489
34 -2.9433777 -0.445332786 -0.18685858  0.050108988 -0.34712485 -0.38836224
35  1.9334685  4.227422253 -1.54289340 -0.835373008 -0.54123998  2.37389028
36 -1.4611450  0.555081258 -1.44670031 -0.273171460  0.41677320 -0.33354615
37 -1.6820407 -0.925297600 -0.31774506 -0.273721372 -0.78520268  0.20360927
38  6.7594616  3.638815421  1.05618063  2.351356035  2.49702755  3.43721377
39  3.4506790 -1.182398955  2.56989757 -1.112911235 -0.05458367  1.43612628
40 -1.0983772 -1.524068762 -0.53200487 -0.477669191 -0.99945377 -0.80297280
41 -1.9193470 -0.016455120 -1.08062219 -0.587236913 -0.63239954 -0.20135310
42  3.4962356  1.519916753  1.31092517 -0.300656841  2.59852281  1.04990713
43 -0.2522021  3.071775273  2.14067078 -1.925517343 -2.27190695 -3.40926804
44 -3.0134705 -0.685824171 -1.17123942 -0.855106884 -0.44275792  0.83905452
45  0.3392488 -0.513300425  0.03908522 -0.176642934 -0.59240146  1.05933117
46 -2.1136312  2.610044185  0.53298151 -0.847818228  0.07520510  0.14163876
47  1.3706778 -2.910358069  1.08475124  1.316261684  6.13811703 -2.14363119
48 13.0708364 -2.725721891  0.42574820 -0.475180731 -0.78335087  0.57890473
49 -2.6464920 -0.380710708 -0.69436207  1.036469413 -0.92018764  0.45363960
50  1.7504813 -0.179844084 -0.26891623 -0.341129747  0.60754876 -0.77667306
51 -3.3724826  3.536458694  5.32705688  7.762674701 -2.31626791 -1.79609628
52 -3.1242143 -1.042445343  0.80437184  2.133119681  2.85592676 -0.90733360
53 -1.0176612 -1.671769226 -1.82862519  0.394960511 -0.46534146  0.86157778
54 -0.3396014  0.750547277  0.95957147 -0.301395219  0.57260088  0.01894730
55 -2.2360197 -0.655876540  0.77645594  0.231805497 -0.27848656 -0.34479229
56 -3.1511256  0.180665062 -1.07019444 -0.491205128 -0.21428914 -0.62572389
           PC7         PC8         PC9
1   1.76446455  0.71374642 -1.27763836
2   1.90946042  0.32026834  0.31575168
3  -0.78560815 -0.92036817 -1.26256359
4  -0.12860754  0.13732138  0.07796673
5   0.74994371  0.71599423 -0.19541169
6  -0.39368588  0.75396577  0.12358783
7  -0.51476890 -1.37312839  0.55597712
8  -0.14340022 -1.64114704  1.14619211
9  -0.12337260  1.64840877  1.12228458
10  1.30112932  0.04017681  0.78534979
11 -1.01949796  0.39458663  0.01823775
12  1.27365641  0.38385941 -0.19143125
13  0.10866259 -1.13950353 -1.57906009
14  1.10103413  0.88533889 -1.19056845
15 -1.01157314 -1.47740924  0.22146676
16  0.35695340  0.88633035 -0.44875630
17 -0.84922663  0.01277585 -0.04793206
18  0.22648544  0.76907240 -0.83845390
19  0.84498090 -0.26045393  0.78929137
20  0.75707090 -1.18661916  1.67512391
21  1.31702137  0.49437991  0.47455077
22 -1.64549969  1.13118828 -0.04484940
23 -0.21184648  0.96993606  1.61645155
24 -0.47378261 -2.62659005  1.14510308
25 -0.38399443  0.27541717  1.00447793
26 -0.69664564  0.94135363  0.17566660
27  0.02791903 -0.36150463 -0.45207374
28 -0.77192847 -0.90604294  2.92091797
29  2.01369673  0.05235085  0.94851213
30 -0.76889273 -0.04319356 -0.93018809
31  1.40987972 -0.23868533  0.11171350
32  1.01379575  1.75474773 -0.29044327
33  0.22672970  0.82917850  0.05368812
34 -1.84413987  0.45197913  0.38530687
35 -0.29186460  0.24777941  0.05260103
36  0.03060274  1.07595713 -0.12917118
37 -0.46866588  0.53016534 -0.43879593
38 -1.42758292 -3.60748873 -1.60176642
39 -0.65914865 -1.03448059 -0.16051740
40 -0.19504945 -1.60842789 -0.69636619
41 -1.31580368 -1.30270411  0.17184914
42 -0.23125332 -0.09689562  0.84640868
43 -2.15443994  0.22710813 -1.25870358
44 -1.00388333  0.40847078 -0.11206689
45  1.16629583  0.52067375 -0.32481693
46  1.09265840 -0.35878735  1.34775109
47  0.97170555  0.19459095 -1.28733565
48  0.96197055  0.51964456 -0.22818731
49  0.21464465 -0.60479462 -0.75320369
50 -0.00577914  0.27805102  1.52332281
51  2.17235909 -0.18750827 -1.11305739
52 -3.95021078  3.06573217 -0.25289702
53 -0.24568069 -0.17110049 -0.38166238
54 -0.04332971  0.06369494  0.62713705
55 -0.03710043  0.79675151 -1.07516939
56  0.78314261 -1.34416256 -1.67360042</code></pre>
</div>
</div>
</section>
</section>
<section id="visualization" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="visualization"><span class="header-section-number">5.7</span> 05 - Visualization</h2>
<section id="scree-plot---cumulative-variance-explained" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="scree-plot---cumulative-variance-explained"><span class="header-section-number">5.7.1</span> Scree Plot - Cumulative Variance Explained</h3>
<ul>
<li><p>PC1 explains 40.8% variance.</p></li>
<li><p>PC2 explains 9.5% variance.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(data_pca, <span class="at">addlabels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="biplot" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="biplot"><span class="header-section-number">5.7.2</span> Biplot</h3>
<p>The correlation between a variable and a principal component (PC) is used as the coordinates of the variable on the PC. The representation of variables differs from the plot of the observations: The observations are represented by their projections, but the variables are represented by their correlations&nbsp;(Abdi and Williams 2010).</p>
<ul>
<li><p>PC1 is represented in black which displays the longest distance of its projection.</p></li>
<li><p>PC2 is represented in blue which displays a shorter distance as expected.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(data_pca, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">"point"</span>, <span class="st">"arrow"</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom.var =</span> <span class="st">"arrow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="correlation-circle" class="level3" data-number="5.7.3">
<h3 data-number="5.7.3" class="anchored" data-anchor-id="correlation-circle"><span class="header-section-number">5.7.3</span> Correlation Circle</h3>
<p>The plot below is also known as variable correlation plots. It shows the relationships between all variables. It can be interpreted as follow:</p>
<ul>
<li><p>Positively correlated variables are grouped together.</p></li>
<li><p>Negatively correlated variables are positioned on opposite sides of the plot origin (opposed quadrants).</p></li>
<li><p>The distance between variables and the origin measures the quality of the variables on the factor map. Variables that are away from the origin are well represented on the factor map.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Control variable colors using their contributions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(data_pca, <span class="at">col.var =</span> <span class="st">"contrib"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">geom.var =</span> <span class="st">"arrow"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="variable-contribution" class="level3" data-number="5.7.4">
<h3 data-number="5.7.4" class="anchored" data-anchor-id="variable-contribution"><span class="header-section-number">5.7.4</span> Variable Contribution</h3>
<p>Top variable contribution for the first two principal components.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contributions of variables to PC1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pc2_contribution <span class="ot">&lt;-</span> <span class="fu">fviz_contrib</span>(data_pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="dv">20</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the theme to rotate X-axis labels to 90 degrees</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>pc2_contribution <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)  <span class="co"># horizontal justification</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Contribution of Variables to PC1"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Percentage Contribution"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"PC1 explains 40.8% variance"</span>) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">accuracy =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contributions of variables to PC2</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pc2_contribution <span class="ot">&lt;-</span> <span class="fu">fviz_contrib</span>(data_pca, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">2</span>, <span class="at">top =</span> <span class="dv">12</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the theme to rotate X-axis labels to 90 degrees</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>pc2_contribution <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)  <span class="co"># horizontal justification</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Contribution of Variables to PC2"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Percentage Contribution"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"PC2 explains 9.5% variance"</span>) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">accuracy =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="model-building" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="model-building"><span class="header-section-number">5.8</span> 06 - Model Building</h2>
<section id="data-splitting-into-training-test-set" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="data-splitting-into-training-test-set"><span class="header-section-number">5.8.1</span> Data Splitting into Training &amp; Test set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)  </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Target y-variable for the training set</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> train_data<span class="sc">$</span>expected_survival  </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and test sets </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(y, <span class="at">SplitRatio =</span> <span class="fl">0.7</span>) </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> <span class="fu">subset</span>(train_data, split <span class="sc">==</span> <span class="cn">TRUE</span>) </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> <span class="fu">subset</span>(train_data, split <span class="sc">==</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-scaling-standardization" class="level3" data-number="5.8.2">
<h3 data-number="5.8.2" class="anchored" data-anchor-id="feature-scaling-standardization"><span class="header-section-number">5.8.2</span> Feature Scaling: Standardization</h3>
<ul>
<li><p>It is important to Mean-Center the data prior to PCA model building to ensure the first Principal Component is in the direction of maximum variance.</p></li>
<li><p>Standardization produces Mean = 0, and Variance = 1.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature Scaling: Standardization</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform centering and scaling on the training and test sets</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(training_set[, <span class="sc">-</span>target_index], </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>training_set[, <span class="sc">-</span>target_index] <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  sc, training_set[, <span class="sc">-</span>target_index])</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>test_set[, <span class="sc">-</span>target_index] <span class="ot">&lt;-</span> <span class="fu">predict</span>(sc, test_set[, <span class="sc">-</span>target_index])</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># training_set[,-target_index] = scale(training_set[, -target_index])</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test_set[,-target_index] = scale(test_set[, -target_index])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="applying-pca-to-training-test-sets" class="level3" data-number="5.8.3">
<h3 data-number="5.8.3" class="anchored" data-anchor-id="applying-pca-to-training-test-sets"><span class="header-section-number">5.8.3</span> Applying PCA to Training &amp; Test sets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Principal Component Analysis (PCA) preprocessing on the training data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(training_set[, <span class="sc">-</span>target_index], </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">'pca'</span>, <span class="at">pcaComp =</span> <span class="dv">8</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA transformation to original training set</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, training_set)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns, moving the dependent feature index to the end</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> training_set[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">1</span>)]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA transformation to original test set</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, test_set)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns, moving the dependent feature index to the end</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>test_set <span class="ot">&lt;-</span> test_set[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="press-predicted-r2-functions" class="level3" data-number="5.8.4">
<h3 data-number="5.8.4" class="anchored" data-anchor-id="press-predicted-r2-functions"><span class="header-section-number">5.8.4</span> PRESS &amp; Predicted R^2 Functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PRESS - predicted residual sums of squares</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>PRESS <span class="ot">&lt;-</span> <span class="cf">function</span>(linear.model) {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the predictive residuals</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  pr <span class="ot">&lt;-</span> <span class="fu">residuals</span>(linear.model)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">lm.influence</span>(linear.model)<span class="sc">$</span>hat)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the PRESS</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  PRESS <span class="ot">&lt;-</span> <span class="fu">sum</span>(pr<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(PRESS)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>pred_r_squared <span class="ot">&lt;-</span> <span class="cf">function</span>(linear.model) {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use anova() to get the sum of squares for the linear model</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  lm.anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(linear.model)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the total sum of squares</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  tss <span class="ot">&lt;-</span> <span class="fu">sum</span>(lm.anova<span class="sc">$</span><span class="st">'Sum Sq'</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the predictive R^2</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  pred.r.squared <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">PRESS</span>(linear.model)<span class="sc">/</span>(tss)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pred.r.squared)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pca-full-model---8-principal-components" class="level3" data-number="5.8.5">
<h3 data-number="5.8.5" class="anchored" data-anchor-id="pca-full-model---8-principal-components"><span class="header-section-number">5.8.5</span> PCA Full Model - 8 Principal Components</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a multiple linear regression model</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>pca_full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(expected_survival <span class="sc">~</span> ., <span class="at">data =</span> training_set)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of the regression model</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expected_survival ~ ., data = training_set)

Residuals:
    Min      1Q  Median      3Q     Max 
-36.203  -9.273   2.228   6.583  35.083 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  97.0513     2.8389  34.187  &lt; 2e-16 ***
PC1          29.4050     0.7133  41.222  &lt; 2e-16 ***
PC2           4.5890     1.3329   3.443  0.00172 ** 
PC3          -1.1111     1.6420  -0.677  0.50381    
PC4           4.9871     1.7472   2.854  0.00775 ** 
PC5          -3.2728     2.2463  -1.457  0.15552    
PC6           6.9790     2.4355   2.866  0.00754 ** 
PC7          -6.6036     2.5605  -2.579  0.01505 *  
PC8           3.8007     2.8211   1.347  0.18799    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.73 on 30 degrees of freedom
Multiple R-squared:  0.983, Adjusted R-squared:  0.9785 
F-statistic: 217.3 on 8 and 30 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate PRESS</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PRESS: "</span>, <span class="fu">PRESS</span>(pca_full_model), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PRESS:  31662.39 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate predicted R^2</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Predicted R^2: "</span>, <span class="fu">pred_r_squared</span>(pca_full_model), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predicted R^2:  0.9430373 </code></pre>
</div>
</div>
</section>
<section id="visualization-of-uncorrelated-pca-matrix" class="level3" data-number="5.8.6">
<h3 data-number="5.8.6" class="anchored" data-anchor-id="visualization-of-uncorrelated-pca-matrix"><span class="header-section-number">5.8.6</span> Visualization of Uncorrelated PCA Matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual of Principal Components un-correlation</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(training_set)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(corr_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="analysis_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="pca---2-principal-components" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="pca---2-principal-components"><span class="header-section-number">5.9</span> PCA - 2 Principal Components</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset with 2 principal components</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>significant_pcs <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">9</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>train_pca <span class="ot">&lt;-</span> training_set[, significant_pcs]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>test_pca <span class="ot">&lt;-</span> test_set[, significant_pcs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a multiple linear regression model</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>reg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(expected_survival <span class="sc">~</span> ., </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_pca)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of the regression model</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expected_survival ~ ., data = train_pca)

Residuals:
    Min      1Q  Median      3Q     Max 
-71.156  -9.381  -3.187   8.080  59.653 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  97.0513     3.5849  27.073  &lt; 2e-16 ***
PC1          29.4050     0.9008  32.644  &lt; 2e-16 ***
PC2           4.5890     1.6832   2.726  0.00983 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.39 on 36 degrees of freedom
Multiple R-squared:  0.9675,    Adjusted R-squared:  0.9657 
F-statistic: 536.5 on 2 and 36 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate PRESS</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PRESS: "</span>, <span class="fu">PRESS</span>(reg_model), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PRESS:  25699.6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate predicted R^2</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Predicted R^2: "</span>, <span class="fu">pred_r_squared</span>(reg_model), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Predicted R^2:  0.9537647 </code></pre>
</div>
</div>
<section id="principal-components-regression" class="level3" data-number="5.9.1">
<h3 data-number="5.9.1" class="anchored" data-anchor-id="principal-components-regression"><span class="header-section-number">5.9.1</span> <strong>Principal Components Regression</strong></h3>
<ul>
<li>PCA is used to calculate principal components that can then be used in&nbsp;principal components regression. This type of regression is often used when&nbsp;multicollinearity&nbsp;exists between predictors in a data set.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> train_pca<span class="sc">$</span>expected_survival</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit PCR</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>pcr_model <span class="ot">&lt;-</span> <span class="fu">pcr</span>(y <span class="sc">~</span> PC1<span class="sc">+</span>PC2, <span class="at">data=</span>train_pca, <span class="at">validation=</span><span class="st">"CV"</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcr_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 39 2 
    Y dimension: 39 1
Fit method: svdpc
Number of components considered: 2

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps
CV           122.5    36.39    24.27
adjCV        122.5    34.68    24.11

TRAINING: % variance explained
   1 comps  2 comps
X    77.74   100.00
y    96.08    96.75</code></pre>
</div>
</div>
</section>
<section id="repeated-cross-validation" class="level3" data-number="5.9.2">
<h3 data-number="5.9.2" class="anchored" data-anchor-id="repeated-cross-validation"><span class="header-section-number">5.9.2</span> Repeated Cross-Validation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeated cross-validation with 5 folds, 3 repetitions</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model </span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>model_cv_repeat <span class="ot">&lt;-</span> <span class="fu">train</span>(expected_survival <span class="sc">~</span> ., </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> train_pca,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">trControl =</span> train_control)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print Overall Model Performance</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_cv_repeat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

39 samples
 2 predictor

No pre-processing
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 35, 35, 35, 35, 35, 35, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  21.19074  0.9728849  16.05276

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
</div>
</section>
<section id="cross-validation" class="level3" data-number="5.9.3">
<h3 data-number="5.9.3" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">5.9.3</span> Cross-Validation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation with n folds</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>k_10 <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># training the model </span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>model_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(expected_survival <span class="sc">~</span> ., </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> train_pca,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trControl =</span> k_10)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print Model Performance</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

39 samples
 2 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 35, 35, 35, 35, 35, 35, ... 
Resampling results:

  RMSE     Rsquared   MAE     
  21.7825  0.9761582  16.14872

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">=</span> model_cv<span class="sc">$</span>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="predictions" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="predictions"><span class="header-section-number">5.10</span> 07 - Predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the index position of the target feature</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>pred_target_index <span class="ot">&lt;-</span> <span class="fu">grep</span>(target_name, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">colnames</span>(test_pca))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Target Feature Index ="</span>, pred_target_index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Target Feature Index = 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Predicted Target Feature (y-test) </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> test_pca[pred_target_index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions using the Cross-Validation model</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">=</span> <span class="fu">predict</span>(model_cv, <span class="at">newdata =</span> test_pca[, <span class="sc">-</span>pred_target_index])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction Results from y_predictions</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(y_pred, <span class="at">digits =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  9  11  12  16  17  18  21  23  25  26  28  40  43  47  48  52  53 
 35 520 310  26 298 125 159 149 191  81   2  86 113 182 585  33  88 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform y_test from data frame to numeric</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>y_test_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(y_test))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Original data</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>y_test_numeric</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  16 442 318  25 284 152 160 141 197  95   2  78  38 171 657   7  92</code></pre>
</div>
</div>
<section id="prediction-metrics" class="level3" data-number="5.10.1">
<h3 data-number="5.10.1" class="anchored" data-anchor-id="prediction-metrics"><span class="header-section-number">5.10.1</span> Prediction Metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Mean Absolute Error (MAE)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>mae_value <span class="ot">&lt;-</span> <span class="fu">mae</span>(y_pred, y_test_numeric)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"MAE ="</span>, mae_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE = 21.90924</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate MSE</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>mse_predict <span class="ot">&lt;-</span> <span class="fu">mean</span>((y_pred <span class="sc">-</span> y_test_numeric)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">MSE ="</span>, mse_predict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
MSE = 1140.189</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RMSE</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>rmse_predict <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y_pred <span class="sc">-</span> y_test_numeric)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">RMSE ="</span>, rmse_predict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
RMSE = 33.76669</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate R-squared (R^2)</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>predicted_r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>((y_test_numeric <span class="sc">-</span> y_pred)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y_test_numeric <span class="sc">-</span> <span class="fu">mean</span>(y_test_numeric))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Predicted R^2 ="</span>, predicted_r2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Predicted R^2 = 0.9600483</code></pre>
</div>
</div>
</section>
</section>
<section id="training-conclusion" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="training-conclusion"><span class="header-section-number">5.11</span> 08 - Training Conclusion</h2>
<p>In conclusion, this project has demonstrated the effectiveness of Principal Component Analysis (PCA) in dimension reduction with the following key points:</p>
<ul>
<li><p>PCA was able to reduce from 37 features down to just 2 principal components.</p></li>
<li><p>The best score of R^2 = 97.61% was from the Linear Regression with Cross-validation model.</p></li>
<li><p>The predicted R^2 = 96%</p></li>
<li><p>The average deviation between the predicted values, and observed values for â€˜Expected Survivalâ€™ is RMSE = 33.77.</p></li>
<li><p>The model has not been exposed to unseen data with a large amount of observations to asses its robustness, and reliability.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./methods.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">References</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>